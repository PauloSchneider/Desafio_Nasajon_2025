unit Interfaces;

interface

uses
  System.Classes, System.Generics.Collections;

type
  // Record para município do arquivo de entrada
  TMunicipioInput = record
    Nome: String;
    Populacao: Integer;
  end;

  // Record para município do IBGE
  TMunicipioIBGE = record
    ID: Integer;
    Nome: string;
    UF: string;
    Regiao: string;
  end;

  // Record para resultado do processamento
  TResultadoProcessamento = record
    MunicipioInput: string;
    PopulacaoInput: Integer;
    MunicipioIBGE: string;
    UF: string;
    Regiao: string;
    IdIBGE: Integer;
    Status: string; // OK, NAO_ENCONTRADO, ERRO_API, AMBIGUO
  end;

  // Record para estatísticas
  TEstatisticas = record
    TotalMunicipios: Integer;
    TotalOK: Integer;
    TotalNaoEncontrado: Integer;
    TotalErroAPI: Integer;
    PopTotalOK: Int64;
    MediasPorRegiao: TDictionary<string, Double>;
    constructor Create(ADummy: Integer);
  end;

  // Interface para leitura de arquivos (Single Responsibility)
  IFileReader = interface
    ['{A1B2C3D4-E5F6-4890-ABCD-EF1234567890}']
    function ReadCSVInput(const AFileName: string): TList<TMunicipioInput>;
  end;

  // Interface para chamadas HTTP (Single Responsibility)
  IHttpClient = interface
    ['{B2C3D4E5-F6A7-4901-BCDE-F12345678901}']
    function GetMunicipiosIBGE: TList<TMunicipioIBGE>;
  end;

  // Interface para matching de municípios (Single Responsibility)
  IMunicipioMatcher = interface
    ['{D4E5F6A7-B8C9-0123-DEF1-234567890123}']
    function Match(const AInput: TMunicipioInput; 
                   const AMunicipiosIBGE: TList<TMunicipioIBGE>): TResultadoProcessamento;
  end;

  // Interface para cálculo de estatísticas (Single Responsibility)
  IStatisticsCalculator = interface
    ['{E5F6A7B8-C9D0-1234-EF12-345678901234}']
    function Calculate(const AResultados: TList<TResultadoProcessamento>): TEstatisticas;
  end;

  // Interface para geração de arquivos de saída (Single Responsibility)
  IOutputGenerator = interface
    ['{F6A7B8C9-D0E1-2345-F123-456789012345}']
    procedure SaveResultadoCSV(const AResultados: TList<TResultadoProcessamento>; 
                                const AFileName: string);
    function GenerateStatsJSON(const AStats: TEstatisticas): string;
  end;

implementation

{ TEstatisticas }

constructor TEstatisticas.Create(ADummy: Integer);
begin
  TotalMunicipios := 0;
  TotalOK := 0;
  TotalNaoEncontrado := 0;
  TotalErroAPI := 0;
  PopTotalOK := 0;
  MediasPorRegiao := TDictionary<string, Double>.Create;
end;

end.
